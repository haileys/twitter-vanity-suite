#!/usr/bin/env ruby
require_relative "../lib-internal/common"

def usage
  abort "Usage: twitter-intersect (<username>.following|<username>.followers)..."
end

usage if ARGV.empty?

threads = ARGV.map { |arg| arg.split(".") }.map { |handle, command|
  case command
  when "following"
    Thread.new { $client.friend_ids(handle).to_a }
  when "followers"
    Thread.new { $client.follower_ids(handle).to_a }
  else
    puts "Unknown command: #{command}"
    puts
    usage
  end
}

puts $client.users(threads.map(&:value).reduce(:&)).map(&:screen_name)
